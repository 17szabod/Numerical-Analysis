%Ill-conditioned matrix:
A=hilb(20)

A =

  Columns 1 through 6

   1.000000000000000   0.500000000000000   0.333333333333333   0.250000000000000   0.200000000000000   0.166666666666667
   0.500000000000000   0.333333333333333   0.250000000000000   0.200000000000000   0.166666666666667   0.142857142857143
   0.333333333333333   0.250000000000000   0.200000000000000   0.166666666666667   0.142857142857143   0.125000000000000
   0.250000000000000   0.200000000000000   0.166666666666667   0.142857142857143   0.125000000000000   0.111111111111111
   0.200000000000000   0.166666666666667   0.142857142857143   0.125000000000000   0.111111111111111   0.100000000000000
   0.166666666666667   0.142857142857143   0.125000000000000   0.111111111111111   0.100000000000000   0.090909090909091
   0.142857142857143   0.125000000000000   0.111111111111111   0.100000000000000   0.090909090909091   0.083333333333333
   0.125000000000000   0.111111111111111   0.100000000000000   0.090909090909091   0.083333333333333   0.076923076923077
   0.111111111111111   0.100000000000000   0.090909090909091   0.083333333333333   0.076923076923077   0.071428571428571
   0.100000000000000   0.090909090909091   0.083333333333333   0.076923076923077   0.071428571428571   0.066666666666667
   0.090909090909091   0.083333333333333   0.076923076923077   0.071428571428571   0.066666666666667   0.062500000000000
   0.083333333333333   0.076923076923077   0.071428571428571   0.066666666666667   0.062500000000000   0.058823529411765
   0.076923076923077   0.071428571428571   0.066666666666667   0.062500000000000   0.058823529411765   0.055555555555556
   0.071428571428571   0.066666666666667   0.062500000000000   0.058823529411765   0.055555555555556   0.052631578947368
   0.066666666666667   0.062500000000000   0.058823529411765   0.055555555555556   0.052631578947368   0.050000000000000
   0.062500000000000   0.058823529411765   0.055555555555556   0.052631578947368   0.050000000000000   0.047619047619048
   0.058823529411765   0.055555555555556   0.052631578947368   0.050000000000000   0.047619047619048   0.045454545454545
   0.055555555555556   0.052631578947368   0.050000000000000   0.047619047619048   0.045454545454545   0.043478260869565
   0.052631578947368   0.050000000000000   0.047619047619048   0.045454545454545   0.043478260869565   0.041666666666667
   0.050000000000000   0.047619047619048   0.045454545454545   0.043478260869565   0.041666666666667   0.040000000000000

  Columns 7 through 12

   0.142857142857143   0.125000000000000   0.111111111111111   0.100000000000000   0.090909090909091   0.083333333333333
   0.125000000000000   0.111111111111111   0.100000000000000   0.090909090909091   0.083333333333333   0.076923076923077
   0.111111111111111   0.100000000000000   0.090909090909091   0.083333333333333   0.076923076923077   0.071428571428571
   0.100000000000000   0.090909090909091   0.083333333333333   0.076923076923077   0.071428571428571   0.066666666666667
   0.090909090909091   0.083333333333333   0.076923076923077   0.071428571428571   0.066666666666667   0.062500000000000
   0.083333333333333   0.076923076923077   0.071428571428571   0.066666666666667   0.062500000000000   0.058823529411765
   0.076923076923077   0.071428571428571   0.066666666666667   0.062500000000000   0.058823529411765   0.055555555555556
   0.071428571428571   0.066666666666667   0.062500000000000   0.058823529411765   0.055555555555556   0.052631578947368
   0.066666666666667   0.062500000000000   0.058823529411765   0.055555555555556   0.052631578947368   0.050000000000000
   0.062500000000000   0.058823529411765   0.055555555555556   0.052631578947368   0.050000000000000   0.047619047619048
   0.058823529411765   0.055555555555556   0.052631578947368   0.050000000000000   0.047619047619048   0.045454545454545
   0.055555555555556   0.052631578947368   0.050000000000000   0.047619047619048   0.045454545454545   0.043478260869565
   0.052631578947368   0.050000000000000   0.047619047619048   0.045454545454545   0.043478260869565   0.041666666666667
   0.050000000000000   0.047619047619048   0.045454545454545   0.043478260869565   0.041666666666667   0.040000000000000
   0.047619047619048   0.045454545454545   0.043478260869565   0.041666666666667   0.040000000000000   0.038461538461538
   0.045454545454545   0.043478260869565   0.041666666666667   0.040000000000000   0.038461538461538   0.037037037037037
   0.043478260869565   0.041666666666667   0.040000000000000   0.038461538461538   0.037037037037037   0.035714285714286
   0.041666666666667   0.040000000000000   0.038461538461538   0.037037037037037   0.035714285714286   0.034482758620690
   0.040000000000000   0.038461538461538   0.037037037037037   0.035714285714286   0.034482758620690   0.033333333333333
   0.038461538461538   0.037037037037037   0.035714285714286   0.034482758620690   0.033333333333333   0.032258064516129

  Columns 13 through 18

   0.076923076923077   0.071428571428571   0.066666666666667   0.062500000000000   0.058823529411765   0.055555555555556
   0.071428571428571   0.066666666666667   0.062500000000000   0.058823529411765   0.055555555555556   0.052631578947368
   0.066666666666667   0.062500000000000   0.058823529411765   0.055555555555556   0.052631578947368   0.050000000000000
   0.062500000000000   0.058823529411765   0.055555555555556   0.052631578947368   0.050000000000000   0.047619047619048
   0.058823529411765   0.055555555555556   0.052631578947368   0.050000000000000   0.047619047619048   0.045454545454545
   0.055555555555556   0.052631578947368   0.050000000000000   0.047619047619048   0.045454545454545   0.043478260869565
   0.052631578947368   0.050000000000000   0.047619047619048   0.045454545454545   0.043478260869565   0.041666666666667
   0.050000000000000   0.047619047619048   0.045454545454545   0.043478260869565   0.041666666666667   0.040000000000000
   0.047619047619048   0.045454545454545   0.043478260869565   0.041666666666667   0.040000000000000   0.038461538461538
   0.045454545454545   0.043478260869565   0.041666666666667   0.040000000000000   0.038461538461538   0.037037037037037
   0.043478260869565   0.041666666666667   0.040000000000000   0.038461538461538   0.037037037037037   0.035714285714286
   0.041666666666667   0.040000000000000   0.038461538461538   0.037037037037037   0.035714285714286   0.034482758620690
   0.040000000000000   0.038461538461538   0.037037037037037   0.035714285714286   0.034482758620690   0.033333333333333
   0.038461538461538   0.037037037037037   0.035714285714286   0.034482758620690   0.033333333333333   0.032258064516129
   0.037037037037037   0.035714285714286   0.034482758620690   0.033333333333333   0.032258064516129   0.031250000000000
   0.035714285714286   0.034482758620690   0.033333333333333   0.032258064516129   0.031250000000000   0.030303030303030
   0.034482758620690   0.033333333333333   0.032258064516129   0.031250000000000   0.030303030303030   0.029411764705882
   0.033333333333333   0.032258064516129   0.031250000000000   0.030303030303030   0.029411764705882   0.028571428571429
   0.032258064516129   0.031250000000000   0.030303030303030   0.029411764705882   0.028571428571429   0.027777777777778
   0.031250000000000   0.030303030303030   0.029411764705882   0.028571428571429   0.027777777777778   0.027027027027027

  Columns 19 through 20

   0.052631578947368   0.050000000000000
   0.050000000000000   0.047619047619048
   0.047619047619048   0.045454545454545
   0.045454545454545   0.043478260869565
   0.043478260869565   0.041666666666667
   0.041666666666667   0.040000000000000
   0.040000000000000   0.038461538461538
   0.038461538461538   0.037037037037037
   0.037037037037037   0.035714285714286
   0.035714285714286   0.034482758620690
   0.034482758620690   0.033333333333333
   0.033333333333333   0.032258064516129
   0.032258064516129   0.031250000000000
   0.031250000000000   0.030303030303030
   0.030303030303030   0.029411764705882
   0.029411764705882   0.028571428571429
   0.028571428571429   0.027777777777778
   0.027777777777778   0.027027027027027
   0.027027027027027   0.026315789473684
   0.026315789473684   0.025641025641026

%Finding the bad x in a smart way
[evec,eval]=eig(A'*A);
oriX=evec(1:20,20)

oriX =

   0.641198029185747
   0.404941518115878
   0.308868632719923
   0.253772967074666
   0.217135634034712
   0.190646380283846
   0.170429192178218
   0.154401179317898
   0.141330480857503
   0.130436152606626
   0.121196278032137
   0.113247261651112
   0.106327157415399
   0.100241949309810
   0.094844551932426
   0.090021225243254
   0.085682497549694
   0.081756930224981
   0.078186730134863
   0.074924596368439

b=A*oriX

b =

   1.222851024116841
   0.772278028933213
   0.589054093504880
   0.483979236608863
   0.414106906705243
   0.363588331159287
   0.325031429774040
   0.294463849948990
   0.269536267095197
   0.248759315432435
   0.231137629819220
   0.215977784685881
   0.202780213629115
   0.191174901970042
   0.180881338031799
   0.171682604235011
   0.163408066008231
   0.155921480265974
   0.149112627715311
   0.142891299146749

[Q,R]=qr(A);
y=Q\b;
newX=R\y
[Warning: Matrix is close to singular or badly scaled. Results may be inaccurate. RCOND =  2.160191e-18.] 

newX =

   0.641198334801911
   0.404899393798070
   0.310233216481312
   0.236500000661425
   0.308962474763111
   0.129078725337568
  -1.443518168697239
   8.377058241136323
 -17.858239679835087
  17.719919771682740
  -4.887377526770872
  11.113942848606866
 -34.236275662324658
   2.946991833992703
  78.074416393112770
 -74.124174194413911
 -32.016069258042428
  92.160809694445874
 -56.278184864137202
  11.979418150890679

%To test the validity of our answer and the significance of matlab's complaints:
norm(A*oriX-A*newX)

ans =

     3.128387061314213e-15

norm(oriX-newX)

ans =

     1.626426014381560e+02

%For this horribly conditioned matrix (2.1e+18), the size of the norm was about 10^(-16+18) off, at 10^2, which makes perfect sense and would completely mess up any calculations with this matrix
%Note that we are using QR factorization, which helps increase the stability
%Now for a well-conditioned matrix:
A=rand(20,20)

A =

  Columns 1 through 6

   0.565001116837957   0.046096312053748   0.469679789785991   0.722731269989584   0.873276052678896   0.331249376872497
   0.598163975776315   0.317919050135889   0.738768505483796   0.388082714145041   0.767734193866064   0.639629519220203
   0.682006928358479   0.234835573455070   0.282070246914272   0.791065427642744   0.569055736676074   0.609467453020352
   0.601487709967789   0.383636973058130   0.134160434366780   0.641288565919215   0.055090317370010   0.315669514574055
   0.302904172789348   0.276852944899754   0.880110051452396   0.026865398103290   0.801197692756916   0.077510050889385
   0.323326371425096   0.476581980948249   0.237370699568004   0.084275933449196   0.474921129048971   0.506043895235841
   0.157649263094541   0.944961004303203   0.826854062339123   0.569476127969249   0.440826701393668   0.549227109632983
   0.597100707590230   0.336547847044249   0.431611248319475   0.926445203736994   0.923789009158231   0.739740720228217
   0.577387900724262   0.404105854285910   0.412388934039033   0.144706431815479   0.257844507195276   0.935751513511293
   0.816700700532398   0.383426938582102   0.887584256710165   0.617830164923683   0.153871940304902   0.006202331130003
   0.217024299208809   0.338825513755868   0.309985561136574   0.364875183018775   0.027098206906231   0.161528962448622
   0.172463598108164   0.582720346078743   0.753062073165844   0.816824616368391   0.235441471397819   0.916866997450883
   0.663621496199049   0.498243367677345   0.825953554180978   0.568449690908612   0.805079554490980   0.083596221888829
   0.311626843620713   0.534526599148316   0.509954340405936   0.986346394849562   0.056782016729742   0.353953215560323
   0.719439081502760   0.188406059036373   0.318560517535794   0.653091857469153   0.884653031443264   0.275743806315795
   0.137734846092563   0.924383959598910   0.812341816862888   0.199204262236138   0.373499345134799   0.195224252096242
   0.498589914491649   0.761506629214100   0.869122625231896   0.085176689490768   0.199637627305069   0.357755786630768
   0.360798946569730   0.883232445734158   0.285823528693978   0.126412466714019   0.306380681009611   0.285939722992488
   0.159451481083005   0.464291882321429   0.094796321172947   0.987018705088471   0.101969715311658   0.089660207850726
   0.344426276464949   0.584446168059379   0.444451857615263   0.962599579598807   0.215422979983171   0.124408719682614

  Columns 7 through 12

   0.470410207163677   0.576628750195448   0.830152480541554   0.515781224454411   0.449971582772760   0.233365133133853
   0.523173819210778   0.451406802570092   0.740381146986568   0.428826210509824   0.004914816470832   0.580442422295004
   0.343242628812654   0.674527068213003   0.183978970942022   0.228827797319019   0.385761870299283   0.769985734642418
   0.582947495136044   0.286051620955329   0.851211186354070   0.377138369712184   0.552476959795654   0.207659530007879
   0.341464166642456   0.727785009526266   0.693439953254886   0.995458750997699   0.891673763267587   0.744293667698306
   0.831758528416447   0.878437523896932   0.069505662187420   0.287654501900116   0.261483783462306   0.469704302701210
   0.861450760539122   0.033563145490371   0.936861207195592   0.131516478663886   0.719145139944484   0.985370922484218
   0.261190601721869   0.744949728050531   0.552769739843669   0.511655733625272   0.052807197949348   0.384275262689417
   0.036061719439544   0.691942856370379   0.532204992654940   0.733657366091277   0.774192344150794   0.984918254675507
   0.368142251643504   0.875249427225347   0.325187874044637   0.316344032933449   0.726804107050938   0.518813397314173
   0.471068671413645   0.241175406390638   0.732426583467547   0.063347118230775   0.391547022755671   0.720926149119661
   0.331865308986893   0.826282128511648   0.302165108475770   0.866969444787995   0.573124779179441   0.258759630395140
   0.698859706001333   0.799402841060397   0.211139179638712   0.658820149718194   0.379678522106950   0.964357465619318
   0.300142839339455   0.801943615368346   0.151057862734117   0.145436331176931   0.368434829679669   0.927428327414169
   0.249831295035010   0.094918471498100   0.099428681603096   0.649653132828332   0.726726286811419   0.160826766005477
   0.751435503613483   0.632979020420949   0.180824436493693   0.193758035747628   0.855051875086794   0.073967213987521
   0.425733975295884   0.884346407275465   0.838746345854005   0.900209209614509   0.664115479532890   0.204055781039923
   0.733437940726624   0.294445146802468   0.338099085838908   0.980279237668623   0.645149988735354   0.543052991379361
   0.465132434374576   0.258711044281345   0.751359852261292   0.539547667260845   0.585757787343002   0.468772477797818
   0.100842486193419   0.558747747137624   0.903307807938996   0.262279074605595   0.327097925306333   0.284463746266207

  Columns 13 through 18

   0.907068167317798   0.335462483521811   0.049998730968277   0.205146554335268   0.223489757213693   0.005631334948932
   0.345470825583776   0.815570407400286   0.240186190558760   0.186309625428756   0.035035690738391   0.188735821695599
   0.540498937711989   0.391011504594046   0.073442115349121   0.825970307582960   0.644347005273219   0.911148240915887
   0.074397142930202   0.881341726224124   0.602689400922036   0.304698909525244   0.539465822238449   0.895282218695379
   0.443717363535401   0.004195819632276   0.488877308200271   0.556830487016754   0.996081215088257   0.840330202706630
   0.690997543923599   0.817618950949918   0.884120120128493   0.890515728209539   0.419234487156696   0.257831055167589
   0.065852241417160   0.345561837461990   0.209299946182873   0.876874798298034   0.950991507072528   0.208698472012292
   0.569433507074248   0.307324576231721   0.674125845769369   0.411006562780291   0.992671203382538   0.348178698768330
   0.450138072737896   0.295483750241116   0.961170499610464   0.065591128868652   0.199148478580004   0.431396628042101
   0.017785848524987   0.249100273693745   0.843080096671026   0.847346469501403   0.870255099425461   0.597493992333731
   0.767057296597562   0.822494533885423   0.593193712611160   0.236066565586631   0.698169049832512   0.377374988230106
   0.554658008484982   0.251455498487536   0.600668104952765   0.056582861892988   0.225536638761585   0.965270953598709
   0.018961080625965   0.404688517571248   0.492291076224360   0.840988717009304   0.600086655409095   0.324712702618871
   0.341031158830392   0.653189875437928   0.666773293754141   0.096600393355012   0.019226233088051   0.577955181203942
   0.617549310637043   0.901021593434800   0.384760969194520   0.183107683660091   0.713248491401723   0.150015622138337
   0.143987290022316   0.979625089479601   0.256996784427730   0.064021244998845   0.523429133757053   0.638621691476883
   0.014340297176367   0.540173934381154   0.516704879159039   0.562767121397646   0.731181598527365   0.610818412030357
   0.580729919412359   0.040553118337957   0.479867646961317   0.877267980028355   0.531443623349625   0.339964318236116
   0.620722957785621   0.924285575588501   0.963668043913768   0.305201445860469   0.866212291410707   0.025851048543367
   0.599683847606458   0.321517679090691   0.087171307430953   0.652300836868839   0.306638530509443   0.730905253376676

  Columns 19 through 20

   0.366110279268382   0.988314585804496
   0.432957089405483   0.290088919820617
   0.123572980323532   0.900542079923513
   0.915275327910459   0.833174527525593
   0.322074018276103   0.665701752911182
   0.018190175073328   0.655473771300193
   0.925508671648062   0.245794587990292
   0.650557849932471   0.111628267447412
   0.433478743907355   0.953206213817967
   0.747028344673061   0.798949517756697
   0.061555669244916   0.259131477303864
   0.216830507276191   0.500604946642486
   0.754998071365105   0.052250412499605
   0.227342860503059   0.413824652771609
   0.848854259353062   0.277842723431222
   0.179049783548585   0.273466649614553
   0.290568722176004   0.924209408675806
   0.992251746841622   0.260790888566615
   0.400053284549533   0.750382054415909
   0.938849340336325   0.629836684974937

cond(A)

ans =

     1.931332212490620e+02

%Finding the bad x in a smart way
[evec,eval]=eig(A'*A);
oriX=evec(1:20,20);
b=A*oriX

b =

   2.186112331467811
   1.923547207248896
   2.658888819179030
   2.359741901643805
   2.476341350651349
   1.937000411977413
   2.541409351952427
   2.013706662444783
   2.069237575100968
   2.543616274542051
   2.127753971622920
   1.838990446613439
   2.098607642270569
   2.290064715687032
   2.228783510930744
   1.946575083652380
   2.577971631825943
   1.908690596694961
   2.393963923834036
   2.132396677116997

[Q,R]=qr(A);
y=Q\b;
newX=R\y

newX =

   0.251980566311199
   0.257688277292797
   0.210348303378356
   0.237162823613893
   0.192311984770405
   0.178518640835510
   0.216164368943907
   0.231275131381133
   0.241976647180535
   0.289566903794187
   0.185821970975414
   0.205303299583405
   0.179752314505168
   0.244696296920240
   0.205025822525495
   0.259285911506105
   0.219463359171529
   0.164708883580302
   0.197538972745724
   0.256308789203202

norm(newX-oriX)

ans =

     3.557914043153436e-15

norm(A*oriX-A*newX)

ans =

     4.009119721819008e-15

%Makes sense, a deviation of 4e-15 is nothing to us, will not even really show up on any calculations, showing how well conditioned this matrix is

diary off
